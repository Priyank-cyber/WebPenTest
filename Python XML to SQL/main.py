import pyodbc
import sys                              #packages
from random import randint
import datetime
import time
from xml.etree import ElementTree


fpath = str(sys.argv[1]) #command line arguement MUST passed correspoding Path of XML file must be entered.

plugid = ['2', '3', '10010', '10011', '10012', '10015', '10016', '10017', '10019', '10020', '10021',                #Corresponding to ID of vulnerabilities reference by report
          '10023', '10024', '10025', '10026', '10027', '10032', '10040', '10105', '10202', '50001', '90001', '90011',
          '90022', '90033']
code = ""

xmlf = ElementTree.parse(fpath)                         #element tree to parse xml

plug = xmlf.findall("site/alerts/alertitem/pluginid")   #find all pluginid tags

#site name/alerts/alertitem/
for i in plug:
    for j in plugid:
        if(i.text == j):
            k = plugid.index(j)
            code+=chr(97+k)                     #generate appropriate code for given report

b = xmlf.find('./site').attrib['name']          #find name attribute of site tag

con = pyodbc.connect("DRIVER={SQL Server};server=*server_name*;database=*Sample*;uid=*username*;pwd=*password*") #connect to SQL server. PLEASE change fields appropriately.
cur = con.cursor()

cur.execute("insert into Table1 (ID,Date,Time,URL,Period,Code,Fails) Values (?,?,?,?,?,?,?)",\
            (randint(1000,9999),datetime.datetime.today().strftime('%Y-%m-%d'),time.strftime("%I:%M:%S"),\  #execution of SQL query with appropriate values provided as parameters
             b,2,code,len(code)))                                                   

con.commit() #commit changes to database

cur.close() #close connections
con.close()








